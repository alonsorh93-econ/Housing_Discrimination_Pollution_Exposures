<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Toxic Discrimination</title>

    <!-- Load Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>

    <!-- Load Leaflet Layer Control -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>

    <!-- Load jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Load D3 --> 
    <script src="https://d3js.org/d3.v4.min.js"></script> 

    <!-- Load Esri Leaflet from CDN -->
    <script src = "https://unpkg.com/esri-leaflet"></script>

    <!-- Esri Leaflet Geocoder -->
    <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder/dist/esri-leaflet-geocoder.css">
    <script src="https://unpkg.com/esri-leaflet-geocoder"></script>

</head>

<style>
    .info {
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
        opacity: 0.8;
    }

    .info h4 {
        margin: 0 0 5px;
        color: #686868;
    }
</style>

<body style="width:1200px; height: 600px;">
    <div id="header">
        <h1>Toxic Land Distribution</h1>
    </div>
    <div id="map" style="width: 80%; height: 80%; position: relative;">
        <!-- <div>
      <div class="info leaflet-control">
          <h4 style='text-align: center;'>TRI Report</h4> -->
        <div id="tri-report" style="text-align: left;">

        </div>
    </div>
    <!--  <div id="map" style="width: 90%; height: 200%; position:relative;" </div> -->




    <script>
        mapLink =
            '<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';


        var Streets = L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; ' + mapLink + ' Contributors',
                maxZoom: 19,
            });

        var house = L.icon({
            iconUrl: './icons/house.png',
            // shadowUrl: './icons/house.png',
            iconSize: [24, 24],
            // shadowSize: [24, 32],
            popupAnchor: [-3, -76]
        });

        var plants = L.icon({
            iconUrl: './icons/plants.png',
            iconSize: [32, 32],
            popupAnchor: [-3, -76]
        });

        var Zipcodes = L.layerGroup();

        $.getJSON("data/zipcodes.geojson", function(data) {

            var zipcodes = L.geoJson(data, {
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(feature.properties.id);
                }
            });
            zipcodes.setStyle({
                fillOpacity: 0.5
            }).addTo(Zipcodes);
            zipcodes.setStyle({
                fillColor: 'grey'
            }).addTo(Zipcodes);
            zipcodes.setStyle({
                stroke: false
            }).addTo(Zipcodes);
        });

        var Circles = L.layerGroup();

        $.getJSON("data/circles.geojson", function(data) {

            var circles = L.geoJson(data, {
                onEachFeature: function(feature, layer) {
                    // layer.bindPopup(feature.properties.id);
                    //   layer.on({
                    //     mouseover: highlightFeature,
                    //     mouseout: resetHighlight,
                    //     // click: zoomToFeature
                    // });
                }
            });
            circles.setStyle({
                fillOpacity: 0.6
            }).addTo(Circles);
            circles.setStyle({
                stroke: false
            }).addTo(Circles);
            circles.setStyle({
                fillColor: 'red'
            }).addTo(Circles);

        });

        var Listings = L.layerGroup();

        $.getJSON("data/listings.geojson", function(data) {

            var listings = L.geoJson(
                data, {
                    onEachFeature: function(feature, layer) {
                        layer.setIcon(house);
                        // layer.bindPopup(feature.properties.id);
                    }
                });
            listings.addTo(Listings);
        });

        var Toxic_plants = L.layerGroup();

        $.getJSON("data/toxic_plants.geojson", function(data) {

            var toxic_plants = L.geoJson(
                data, {
                    onEachFeature: function(feature, layer) {
                        layer.setIcon(plants);
                        // layer.bindPopup(feature.properties.id);
                        layer.on({
                            mouseover: highlightFeature,
                            mouseout: resetHighlight,
                            // click: zoomToFeature
                        });
                    }
                }).addTo(Toxic_plants);
        });

        var map = L.map('map', {
            center: [44.91034, -91.8788],
            zoom: 10,
            layers: [Streets, Zipcodes, Toxic_plants]
        });
        

        var baseLayers = {
            "Streets": Streets
        };

        var overlays = {
            'Zipcodes': Zipcodes,
            'Circles': Circles,
            'Housing': Listings,
            'Toxic_plants': Toxic_plants
        };

        L.control.layers(baseLayers, overlays).addTo(map);


        // control that shows state info on hover
        var info = L.control();

        info.onAdd = function(map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
        // add table to present
        info.update = function(props) {

            this._div.innerHTML = '<h4>TRI Report</h4>' + (props ?
                '<table>' +
                '<tr><th>Facility Name:</th>' + '<td>' + props.facility_name + '</td></tr>' +
                '<tr><th>City:</th>' + '<td>' + props.city + '</td></tr>' +
                '<tr><th>County:</th>' + '<td>' + props.county + '</td></tr>' +
                '<tr><th>State:</th>' + '<td>' + props.st + '</td></tr>' +
                '<tr><th>Figutive Air Release:</th>' + '<td>' + props["x5.1_fugitive_air"] + ' \tPounds</td></tr>' + 
                '<tr><th>Stack Air Release:</th>' + '<td>' + props["x5.2_stack_air"] + '\t Pounds</td></tr>' +
                '<tr><th>Release Total(onsite):</th>' + '<td>' + props["on.site_release_total"] + ' \tPounds</td></tr>' :
                'Hover over a toxic plant');

        };


        info.addTo(map);

        function highlightFeature(e) {
            var layer = e.target;

            // console.log(layer.feature.properties.id);

            info.update(layer.feature.properties);
        }

        function resetHighlight(e) {
            // geojson.resetStyle(e.target);
            info.update();
        }

        var searchControl = L.esri.Geocoding.geosearch().addTo(map);
        searchControl.on("overlays", function(data){
          overlays.clearLayers();
          for(var i = data.overlays.length - 1; i >= 0; i--){
            overlays.addLayer(L.marker(data.overlays[i].latlng));
          }
        });



    </script>
    <!-- /.row -->



</body>
<!-- Footer -->
<footer>
    <div class="row">
        <div class="col-lg-12">
            <p>GNU General Public License (GPL), version 2</p>
        </div>
    </div>
</footer>

</html>